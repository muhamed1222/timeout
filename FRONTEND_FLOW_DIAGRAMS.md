# Ğ”Ğ˜ĞĞ“Ğ ĞĞœĞœĞ« ĞŸĞĞ¢ĞĞšĞĞ’ Ğ”ĞĞĞĞ«Ğ¥ Ğ¤Ğ ĞĞĞ¢Ğ•ĞĞ”Ğ

## ğŸ“Š Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

---

## ğŸ— ĞĞ‘Ğ©ĞĞ¯ ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Ğ‘Ğ ĞĞ£Ğ—Ğ•Ğ                                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    index.html                             â”‚  â”‚
â”‚  â”‚                        â†“                                  â”‚  â”‚
â”‚  â”‚                   main.tsx                                â”‚  â”‚
â”‚  â”‚                        â†“                                  â”‚  â”‚
â”‚  â”‚                     App.tsx                               â”‚  â”‚
â”‚  â”‚                        â†“                                  â”‚  â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â”‚
â”‚  â”‚         â”‚                              â”‚                  â”‚  â”‚
â”‚  â”‚    Public Routes             Protected Routes            â”‚  â”‚
â”‚  â”‚    - /login                  - / (Dashboard)             â”‚  â”‚
â”‚  â”‚    - /register               - /exceptions               â”‚  â”‚
â”‚  â”‚    - /webapp                 - /rating                   â”‚  â”‚
â”‚  â”‚                              - /employees                â”‚  â”‚
â”‚  â”‚                              - /reports                  â”‚  â”‚
â”‚  â”‚                              - /schedules                â”‚  â”‚
â”‚  â”‚                              - /settings                 â”‚  â”‚
â”‚  â”‚                              - /company                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  React Query       â”‚  â”‚  Supabase Auth   â”‚                 â”‚
â”‚  â”‚  (State Manager)   â”‚  â”‚  (Authentication)â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API Routes    â”‚
                    â”‚   /api/*        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Backend Server â”‚
                    â”‚   Express.js    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ĞŸĞĞ¢ĞĞš ĞĞ£Ğ¢Ğ•ĞĞ¢Ğ˜Ğ¤Ğ˜ĞšĞĞ¦Ğ˜Ğ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User fills Register form
    â†“
[full_name, company_name, email, password]
    â†“
react-hook-form validation (zod)
    â†“
POST /api/auth/register â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                                        â”‚
Backend creates:                             â”‚
  1. Supabase user                          â”‚
  2. Company record                         â”‚
  3. Sets user_metadata.company_id          â”‚
    â†“                                        â”‚
Success Response â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Supabase signInWithPassword(email, password)
    â†“
Session created â†’ redirect to "/"


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Ğ’Ğ¥ĞĞ”                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User fills Login form
    â†“
[email, password]
    â†“
react-hook-form validation (zod)
    â†“
Supabase signInWithPassword(email, password)
    â†“
Session created with user_metadata.company_id
    â†“
redirect to "/"


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AUTH STATE MANAGEMENT                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

useAuth() hook (in every protected page)
    â†“
supabase.auth.getSession() â”€â”€â”€â”€â”€â†’ Initial session
    â†“
supabase.auth.onAuthStateChange() â†’ Subscribe to changes
    â†“
    â”œâ”€ User logs in  â†’ setAuthState({ user, companyId, loading: false })
    â”œâ”€ User logs out â†’ setAuthState({ user: null, companyId: null, loading: false })
    â””â”€ Session refresh â†’ Update state
    â†“
App.tsx checks authState:
    â†“
    â”œâ”€ loading: true  â†’ Show Loader
    â”œâ”€ user: null     â†’ Redirect to /login
    â””â”€ user: exists   â†’ Render Protected Routes
```

---

## ğŸ“Š DASHBOARD - Ğ“Ğ›ĞĞ’ĞĞĞ¯ Ğ¡Ğ¢Ğ ĞĞĞ˜Ğ¦Ğ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DASHBOARD DATA FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Dashboard.tsx (mount)
    â†“
useAuth() â†’ { companyId, loading }
    â†“
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                      â†“                      â†“
useQuery:            useQuery:           useState:
stats                active shifts       searchQuery
    â†“                      â†“                      â†“
GET /api/companies/  GET /api/companies/    Local filter
:companyId/stats     :companyId/shifts/     state
                     active
    â†“                      â†“                      â†“
{                    [{                     "john doe"
  totalEmployees,      id,
  activeShifts,        employee: {
  completedShifts,       full_name,
  exceptions             position
}                      },
                       shift_start,
                       shift_end,
                       status,
                       current_work_interval,
                       current_break_interval,
                       daily_report
                     }, ...]
    â†“                      â†“                      â†“
DashboardStats       Transform to         Filter by
component            ShiftCard props      searchQuery
    â†“                      â†“                      â†“
Render 4 stat        Map to               Display
cards                transformedShifts    filtered
                         â†“                 shifts
                     Generate
                     RecentActivity
                     from intervals
                         â†“
                     Render:
                     - ShiftCard[] (grid)
                     - RecentActivity (sidebar)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       USER INTERACTIONS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Search Input] â”€â”€â”€â”€â†’ setSearchQuery() â”€â”€â”€â”€â†’ Filter transformedShifts

[Filter Button] â”€â”€â”€â†’ handleFilter() â”€â”€â”€â”€â”€â”€â†’ âŒ Toast only (not implemented)

[Export Button] â”€â”€â”€â†’ handleExport() â”€â”€â”€â”€â”€â”€â†’ Generate CSV:
                                              1. Map filtered data
                                              2. Create CSV string
                                              3. Create Blob
                                              4. Download file

[Add Employee] â”€â”€â”€â”€â†’ setShowAddEmployeeModal(true)
                         â†“
                   Open AddEmployeeModal
                         â†“
                   User fills form
                         â†“
                   POST /api/employee-invites
                         â†“
                   Show QR code + link


[ShiftCard Buttons]:
  - "ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ" â”€â”€â”€â”€â†’ âŒ console.log only (no implementation)
  - "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ" â”€â”€â”€â”€â†’ âŒ console.log only (no implementation)
```

---

## âš ï¸ EXCEPTIONS - Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EXCEPTIONS DATA FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Exceptions.tsx (mount)
    â†“
useAuth() â†’ { companyId }
    â†“
useQuery: /api/companies/:companyId/exceptions
    â†“
Response: [{
  id,
  employee: { full_name },
  exception_type: 'late_arrival',  â† Backend format
  description,
  detected_at,
  severity: 1 | 2 | 3
}, ...]
    â†“
mapExceptionType(): Backend â†’ Frontend
    'late_arrival'     â†’ 'late'
    'early_departure'  â†’ 'short_day'
    'extended_break'   â†’ 'long_break'
    'no_report'        â†’ 'no_report'
    'no_show'          â†’ 'no_show'
    â†“
transformedExceptions[]
    â†“
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“             â†“             â†“             â†“
Filter by:   Filter by:    Filter by:    Render
searchQuery  severity      type          ExceptionCard[]


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       USER INTERACTIONS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Search Input] â”€â”€â”€â”€â”€â”€â”€â”€â†’ setSearchQuery() â”€â”€â”€â”€â†’ Local filter

[Severity Badge] â”€â”€â”€â”€â”€â”€â†’ handleSeverityFilter() â†’ Toggle filter

[Type Badge] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ handleTypeFilter() â”€â”€â”€â†’ Toggle filter

[Clear Filters] â”€â”€â”€â”€â”€â”€â”€â†’ clearFilters() â”€â”€â”€â”€â”€â”€â”€â†’ Reset all filters


[ExceptionCard Buttons]:
  - "Ğ ĞµÑˆĞ¸Ñ‚ÑŒ" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ âŒ console.log only (no API endpoint)
  - "Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ" â”€â”€â”€â”€â”€â”€â”€â†’ âŒ console.log only (no implementation)
```

---

## ğŸ† RATING - Ğ Ğ•Ğ™Ğ¢Ğ˜ĞĞ“ Ğ¡ĞĞ¢Ğ Ğ£Ğ”ĞĞ˜ĞšĞĞ’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RATING DATA FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Rating.tsx (mount)
    â†“
useAuth() â†’ { companyId }
    â†“
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                      â†“                      â†“              â†“
useQuery:            useQuery:             useQuery:       useState:
employees            ratings               rules           filters
    â†“                      â†“                      â†“              â†“
GET /api/            GET /api/             GET /api/       period,
companies/           companies/            companies/      sortBy,
:id/employees        :id/ratings?          :id/violation-  search
                     periodStart=...       rules
                     &periodEnd=...
    â†“                      â†“                      â†“              â†“
[{                   [{                    [{                "current"
  id,                  employee_id,          id,             "rating"
  full_name,           rating: 95.5          code,           "john"
  position             }, ...]               name,
}, ...]                                      penalty_percent,
                                             auto_detectable,
                                             is_active
                                           }, ...]
    â†“                      â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â†’ Merge data:
                                       employees.map(emp => ({
                                         ...emp,
                                         rating: ratingsMap.get(emp.id) || 100
                                       }))
                                           â†“
                                      employeesWithRating[]
                                           â†“
                                      Filter & Sort
                                           â†“
                                      Render Rating Cards with:
                                      - Progress bar
                                      - Rating badge
                                      - Add Violation button


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADD VIOLATION FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ" on Rating Card
    â†“
setSelectedEmployee(employee)
setIsViolationModalOpen(true)
    â†“
Open Modal with:
  - Select: violation rules (from query)
  - Input: comment (optional)
    â†“
User selects rule + adds comment
    â†“
Submit â†’ useMutation: POST /api/violations
    {
      employee_id: selectedEmployee.id,
      company_id,
      rule_id: selectedRuleId,
      source: 'manual',
      reason: violationComment
    }
    â†“
On Success:
  â”œâ”€ Show toast notification
  â”œâ”€ Close modal
  â”œâ”€ Clear form state
  â””â”€ queryClient.invalidateQueries(['/api/companies', companyId, 'ratings'])
      â†“
      Automatic refetch ratings
      â†“
      Rating recalculated on backend
      â†“
      UI updates with new rating
```

---

## ğŸ‘¥ EMPLOYEES - Ğ¡ĞĞ¢Ğ Ğ£Ğ”ĞĞ˜ĞšĞ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EMPLOYEES DATA FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Employees.tsx (mount)
    â†“
useAuth() â†’ { companyId }
    â†“
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                          â†“                            â†“
useQuery:                 useQuery:                   useState:
employees                 invites                     filters
refetchInterval: 5s       refetchInterval: 5s         
    â†“                          â†“                            â†“
GET /api/companies/       GET /api/companies/         searchQuery,
:id/employees             :id/employee-invites        selectedStatus
    â†“                          â†“                            â†“
[{                        [{                          "john", "active"
  id,                       id,
  full_name,                code: "ABC123",
  position,                 full_name,
  telegram_user_id,         position,
  status: 'active',         used_at: null,
  tz                        created_at
}, ...]                   }, ...]
    â†“                          â†“                            â†“
Filter by status          Filter: !used_at            Filter by search
    â†“                          â†“                            â†“
Render:                   Render:                     Display filtered
Employee Cards            Active Invite Cards         results


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADD EMPLOYEE FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°"
    â†“
setShowAddEmployeeModal(true)
    â†“
AddEmployeeModal opens
    â†“
User fills form:
  - full_name (required)
  - position (optional)
    â†“
Submit â†’ useMutation: POST /api/employee-invites
    {
      company_id,
      full_name,
      position
    }
    â†“
Response: { id, code, full_name, position }
    â†“
Fetch invite link:
GET /api/employee-invites/:code/link
    â†“
Response: {
  code,
  deep_link: "https://t.me/bot?start=ABC123",
  qr_code_url: "data:image/png;base64,..."
}
    â†“
Display:
  â”œâ”€ QR Code (scannable)
  â”œâ”€ Invite code
  â”œâ”€ Deep link (copyable)
  â””â”€ Instructions for employee
    â†“
On close:
  â”œâ”€ queryClient.invalidateQueries(['employee-invites'])
  â””â”€ Employees list auto-updates (polling)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DELETE INVITE FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "Delete" on Invite Card
    â†“
useMutation: âŒ DELETE /api/employee-invites/:id
    â†“
    [ISSUE: Wrong syntax!]
    Current: apiRequest(`/api/.../${id}`, { method: 'DELETE' })
    Correct: apiRequest('DELETE', `/api/.../${id}`)
    â†“
On Success:
  â”œâ”€ Show toast
  â””â”€ refetchInvites()
```

---

## ğŸ“‹ REPORTS - ĞĞ¢Ğ§Ğ•Ğ¢Ğ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REPORTS DATA FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Reports.tsx (mount)
    â†“
useAuth() â†’ { companyId }
    â†“
useQuery: /api/companies/:companyId/daily-reports
    â†“
Response: [{
  id,
  shift_id,
  planned_items: ["Task 1", "Task 2"],
  done_items: ["Task 1 done", "Task 2 done"],
  blockers: "Issue with ...",
  tasks_links: ["https://..."],
  time_spent: {...},
  attachments: {...},
  submitted_at: "2025-10-26T10:00:00Z",
  shift: {
    id,
    employee_id,
    planned_start_at,
    planned_end_at,
    actual_start_at,
    actual_end_at,
    status
  },
  employee: {
    id,
    full_name,
    position
  }
}, ...]
    â†“
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                     â†“                     â†“
Filter by:           Filter by:          Render:
searchQuery          selectedDate        Report Cards
(employee name       (date picker)       with employee
or report text)                          + shift + report
    â†“                     â†“                     â†“
Filtered reports displayed


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       EXPORT TO CSV                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚"
    â†“
Check: filteredReports.length > 0
    â†“
Map data to CSV format:
  {
    Ğ”Ğ°Ñ‚Ğ°: format(date, 'dd.MM.yyyy'),
    Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº: full_name,
    Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ: position,
    ĞÑ‚Ñ‡ĞµÑ‚: done_items.join('; '),
    ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ: blockers,
    ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½: format(submitted_at, 'dd.MM.yyyy HH:mm')
  }
    â†“
Create CSV string with headers + rows
    â†“
Add UTF-8 BOM: '\uFEFF' + csv
    â†“
Create Blob: new Blob([csv], { type: 'text/csv;charset=utf-8;' })
    â†“
Download: reports_YYYY-MM-DD.csv
```

---

## ğŸ“… SCHEDULES - Ğ“Ğ ĞĞ¤Ğ˜ĞšĞ˜ Ğ ĞĞ‘ĞĞ¢Ğ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SCHEDULES DATA FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Schedules.tsx (mount)
    â†“
useAuth() â†’ { companyId }
    â†“
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                          â†“                            â†“
useQuery:                 useQuery:                   useState:
templates                 employees                   forms
    â†“                          â†“                            â†“
GET /api/companies/       GET /api/companies/         isTemplateOpen,
:id/schedule-templates    :id/employees               isAssignOpen,
                                                      selectedWorkdays
    â†“                          â†“                            â†“
[{                        [{                          [1,2,3,4,5]
  id,                       id,                       (Mon-Fri)
  company_id,               full_name,
  name: "5/2",              position
  rules: {                }, ...]
    shift_start: "09:00",
    shift_end: "18:00",
    workdays: [1,2,3,4,5]
  }
}, ...]
    â†“                          â†“
Filter by search          Used in assign modal
    â†“                          â†“
Render:                   Select employee for
Template Cards            schedule assignment


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CREATE TEMPLATE FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ³Ñ€Ğ°Ñ„Ğ¸Ğº"
    â†“
Open Dialog with form:
  - name: string
  - shift_start: time
  - shift_end: time
  - workdays: number[] (selected via badges)
    â†“
User fills form and selects workdays
    â†“
Submit â†’ useMutation: POST /api/schedule-templates
    {
      company_id,
      name,
      rules: {
        shift_start,
        shift_end,
        workdays: selectedWorkdays  â† [ISSUE: Not synced with form]
      }
    }
    â†“
On Success:
  â”œâ”€ queryClient.invalidateQueries(['schedule-templates'])
  â”œâ”€ templateForm.reset()
  â”œâ”€ setIsTemplateOpen(false)
  â””â”€ Show toast


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ASSIGN SCHEDULE FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "ĞĞ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ğ³Ñ€Ğ°Ñ„Ğ¸Ğº"
    â†“
Open Dialog with form:
  - employee_id: select from employees
  - schedule_id: select from templates
  - valid_from: date (default: today)
  - valid_to: date (optional)
    â†“
Submit â†’ useMutation: POST /api/employee-schedule
    {
      employee_id,
      schedule_id,
      valid_from,
      valid_to: valid_to || null
    }
    â†“
On Success:
  â”œâ”€ assignForm.reset()
  â”œâ”€ setIsAssignOpen(false)
  â””â”€ Show toast
    â†“
    [ISSUE: No visual feedback of assigned schedules]
```

---

## âš™ï¸ COMPANY SETTINGS - ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ ĞšĞĞœĞŸĞĞĞ˜Ğ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COMPANY SETTINGS DATA FLOW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CompanySettings.tsx (mount)
    â†“
useAuth() â†’ { companyId }
    â†“
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                          â†“                            â†“
useQuery:                 useQuery:                   Render:
company info              violation rules             Tabs
    â†“                          â†“                            â†“
GET /api/companies/       GET /api/companies/         - General
:id                       :id/violation-rules         - Violations
                                                      - Info
    â†“                          â†“
{                         [{
  id,                       id,
  name: "ĞĞĞ Ğ¢ĞµÑ…ĞºĞ¾Ğ¼",       company_id,
  tz: "Europe/Moscow",      code: "late",
  settings: {...}           name: "ĞĞ¿Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ",
}                           penalty_percent: 5,
                            auto_detectable: true,
                            is_active: true
                          }, ...]


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UPDATE COMPANY FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User edits form in "General" tab:
  - name: string
  - tz: select
    â†“
Submit â†’ useMutation: PUT /api/companies/:companyId
    { name, tz }
    â†“
On Success:
  â”œâ”€ queryClient.invalidateQueries(['/api/companies', companyId])
  â””â”€ Show toast


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ADD/EDIT VIOLATION RULE FLOW                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾" in "Violations" tab
    â†“
Open custom modal (not Dialog UI) with form:
  - code: string (unique check on client only)
  - name: string
  - penalty_percent: number (1-100)
  - auto_detectable: boolean
  - is_active: boolean
    â†“
Submit:
  â”œâ”€ Check code uniqueness (client-side)
  â”œâ”€ If editing: PUT /api/violation-rules/:id
  â””â”€ If creating: POST /api/violation-rules
    {
      company_id,
      code,
      name,
      penalty_percent: String(penalty_percent),
      auto_detectable,
      is_active
    }
    â†“
On Success:
  â”œâ”€ queryClient.invalidateQueries(['violation-rules'])
  â”œâ”€ Close modal
  â””â”€ Show toast


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TOGGLE RULE ACTIVE STATUS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User toggles Switch in rules table
    â†“
useMutation: PUT /api/violation-rules/:id
    { ...rule, is_active: newValue }
    â†“
On Success:
  â”œâ”€ queryClient.invalidateQueries(['violation-rules'])
  â””â”€ UI updates immediately (optimistic update)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       LOGOUT FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks "Ğ’Ñ‹Ğ¹Ñ‚Ğ¸"
    â†“
supabase.auth.signOut()
    â†“
queryClient.clear()
    â†“
setLocation('/login')
    â†“
Show toast notification
```

---

## ğŸ“± WEBAPP - TELEGRAM MINI APP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WEBAPP INITIALIZATION                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WebAppPage.tsx (mount)
    â†“
Initialize Telegram WebApp:
  window.Telegram?.WebApp || mockTelegramWebApp
    â†“
Get Telegram user ID:
  tg.initDataUnsafe?.user?.id || "123456789" (mock)
    â†“
setTelegramId(userId)
    â†“
Request Geolocation:
  navigator.geolocation.getCurrentPosition()
    â†“
setLocation("lat,lng" | "unknown" | "not_supported")
    â†“
useQuery: âŒ GET /api/webapp/employee/:telegramId
    â†“
    [ISSUE: This endpoint doesn't exist on backend!]
    â†“
Response (expected): {
  employee: { id, name, telegram_user_id },
  activeShift: {...},
  workIntervals: [...],
  breakIntervals: [...],
  status: 'off_work' | 'working' | 'on_break' | 'unknown'
}


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SHIFT MANAGEMENT FLOW                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Status: 'off_work'
    â†“
User clicks "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¼ĞµĞ½Ñƒ"
    â†“
useMutation: âŒ POST /api/webapp/shift/start
    headers: { 'X-Telegram-Init-Data': tg.initData }
    body: { telegramId }
    â†“
    [ISSUE: Endpoint doesn't exist!]
    Expected: Create shift and work interval
    â†“
On Success:
  â”œâ”€ queryClient.invalidateQueries(['employee', telegramId])
  â””â”€ Status changes to 'working'


Status: 'working'
    â†“
User has two options:
    â”œâ”€ "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ²"
    â”‚   â†“
    â”‚   âŒ POST /api/webapp/break/start
    â”‚   { telegramId }
    â”‚   â†“
    â”‚   Expected: End work interval, start break interval
    â”‚   â†“
    â”‚   Status â†’ 'on_break'
    â”‚
    â””â”€ "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ ÑĞ¼ĞµĞ½Ñƒ"
        â†“
        âŒ POST /api/webapp/shift/end
        { telegramId }
        â†“
        Expected: End work interval, complete shift
        â†“
        Status â†’ 'off_work'


Status: 'on_break'
    â†“
User clicks "Ğ—Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ²"
    â†“
useMutation: âŒ POST /api/webapp/break/end
    { telegramId }
    â†“
    Expected: End break interval, start work interval
    â†“
Status â†’ 'working'


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ISSUES                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ All 5 API endpoints don't exist on backend:
  - GET  /api/webapp/employee/:id
  - POST /api/webapp/shift/start
  - POST /api/webapp/shift/end
  - POST /api/webapp/break/start
  - POST /api/webapp/break/end

âš ï¸ Geolocation is requested but never sent to server

âš ï¸ Mock Telegram SDK in development mode
```

---

## ğŸ”„ REACT QUERY CACHE STRATEGY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QUERY CACHE STRUCTURE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

queryClient
    â”œâ”€ ['/api/companies', companyId, 'stats']
    â”‚    â†“
    â”‚    Cache invalidated when:
    â”‚    - Shift is started
    â”‚    - Shift is ended
    â”‚
    â”œâ”€ ['/api/companies', companyId, 'shifts', 'active']
    â”‚    â†“
    â”‚    No automatic refetch
    â”‚    Invalidated when: shift updates
    â”‚
    â”œâ”€ ['/api/companies', companyId, 'employees']
    â”‚    â†“
    â”‚    refetchInterval: 5000ms (in Employees page)
    â”‚    refetchOnWindowFocus: true (in Employees page)
    â”‚
    â”œâ”€ ['/api/companies', companyId, 'employee-invites']
    â”‚    â†“
    â”‚    refetchInterval: 5000ms (in Employees page)
    â”‚    refetchOnWindowFocus: true (in Employees page)
    â”‚
    â”œâ”€ ['/api/companies', companyId, 'ratings', period]
    â”‚    â†“
    â”‚    Invalidated when: violation is added
    â”‚
    â”œâ”€ ['/api/companies', companyId, 'violation-rules']
    â”‚    â†“
    â”‚    Invalidated when: rule is created/updated/deleted
    â”‚
    â””â”€ ['/api/companies', companyId, 'schedule-templates']
         â†“
         Invalidated when: template is created/deleted


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CACHE INVALIDATION STRATEGY                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After mutation success:
    â†“
queryClient.invalidateQueries({ queryKey: [...] })
    â†“
Triggers automatic refetch of matching queries
    â†“
UI updates with fresh data


Manual cache.delete():
    â†“
Used in server/routes.ts for company stats cache
    â†“
Ensures fresh stats after shift changes
```

---

## ğŸ“Š SUMMARY OF FLOWS

### âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğµ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¸:
1. Authentication (Login/Register)
2. Dashboard stats display
3. Rating with violations
4. Employees management with invites
5. Reports display with export
6. Schedules management
7. Company settings

### âš ï¸ Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğµ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¸:
1. Dashboard (RecentActivity has data access issues)
2. Exceptions (buttons don't work)
3. Rating (period selection not implemented)
4. Schedules (no visual feedback for assignments)

### âŒ ĞĞµÑ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğµ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¸:
1. WebApp (all endpoints missing)
2. Settings page (fully mock)
3. ExceptionCard actions (resolve/contact)
4. ShiftCard actions (view details/send message)

---

_Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°._

