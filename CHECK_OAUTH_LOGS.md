# üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Yandex OAuth

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ `npm run dev`, –ª–æ–≥–∏ –±—É–¥—É—Ç –≤ —ç—Ç–æ–º –∂–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.

### –®–∞–≥ 2: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/login`.

### –®–∞–≥ 3: –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤:

#### ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –ø–æ—Ç–æ–∫:

```
[INFO] Yandex OAuth init { callbackUrl: 'http://localhost:3001/api/auth/yandex/callback', ... }
[INFO] Yandex OAuth callback received { query: {...}, cookies: {...} }
[INFO] Processing Yandex OAuth code exchange { code: '...' }
[INFO] Exchanging code for token { clientId: '...', callbackUrl: '...' }
[INFO] Token exchange successful
[INFO] Got access token from Yandex
[INFO] Fetching user info from Yandex
[INFO] Checking if user exists { email: '...' }
[INFO] Existing user logged in via Yandex { userId: '...', email: '...' }
[INFO] Extracting token from magic link { ... }
[INFO] Redirecting to frontend with auth hash { hashLength: ..., frontendUrl: '...' }
```

#### ‚ùå –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞:

–í—ã —É–≤–∏–¥–∏—Ç–µ `[ERROR]` —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:

```
[ERROR] Error in Yandex OAuth callback {
  error: '...',
  stack: '...',
  name: '...',
  code: '...',
  details: {...}
}
```

### –®–∞–≥ 4: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫—É

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å –±–ª–æ–∫** –æ—à–∏–±–∫–∏, –≤–∫–ª—é—á–∞—è:
- `error` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- `stack` ‚Äî —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
- `details` ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üéØ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è –ø–æ –ª–æ–≥–∞–º:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: `getUserByEmail` –ø–∞–¥–∞–µ—Ç

**–õ–æ–≥–∏:**
```
[ERROR] Error getting user by email { error: {...}, email: '...' }
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase –∏ `SUPABASE_SERVICE_ROLE_KEY`.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ —É–¥–∞—ë—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é

**–õ–æ–≥–∏:**
```
[ERROR] Failed to create company { error: {...} }
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: `generateLink` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–õ–æ–≥–∏:**
```
[ERROR] Failed to generate auth link { error: {...} }
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `SUPABASE_SERVICE_ROLE_KEY` –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Supabase Auth.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ—Ç `action_link` –≤ –æ—Ç–≤–µ—Ç–µ

**–õ–æ–≥–∏:**
```
[ERROR] No action_link in magic link response { linkData: {...} }
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Supabase `generateLink`. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥.

---

## üì§ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–µ –ª–æ–≥–∏** –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å `[INFO]` –∏ `[ERROR]`)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ø—Ä–æ—Ü–µ—Å—Å
3. **–°—Ä–∞–≤–Ω–∏—Ç–µ** —Å –æ–∂–∏–¥–∞–µ–º–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –≤—ã—à–µ
4. **–ù–∞–π–¥–∏—Ç–µ** –ø–µ—Ä–≤—É—é –æ—à–∏–±–∫—É ‚Äî –æ–Ω–∞ –æ–±—ã—á–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∏—á–∏–Ω—É

---

## üí° –°–æ–≤–µ—Ç:

–ï—Å–ª–∏ –ª–æ–≥–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤–æ–æ–±—â–µ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –°–µ—Ä–≤–µ—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω (`npm run dev`)
2. –ó–∞–ø—Ä–æ—Å –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ Network –≤ DevTools)
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ `server/lib/logger.ts`

